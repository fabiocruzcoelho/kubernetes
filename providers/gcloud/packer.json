{
    "variables": {
          "gcloud_account_json": "{{env `GCLOUD_CREDENTIALS`}}",
          "gcloud_project_id": "devopsestudos",
          "gcloud_image_name": "{{ env `CI_COMMIT_SHORT_SHA`}}",
          "gcloud_ssh_username": "ubuntu",
          "gcloud_disk_size": "20"
    },
    "builders": [
        {
          "type": "googlecompute",
          "account_file": "{{user `gcloud_account_json`}}",
          "project_id": "{{user `gcloud_project_id`}}",
          "ssh_username": "{{user `gcloud_ssh_username`}}",
          "source_image_family": "ubuntu-1804-lts",
          "image_name": "kubeadmin-{{user `gcloud_image_name`}}",
          "zone": "northamerica-northeast1-a",
          "machine_type":"n1-standard-1",
          "disk_size": "{{user `gcloud_disk_size`}}",
          "on_host_maintenance":"TERMINATE",
          "image_family":"k8s"
        }
      ],

      "provisioners": [
        {
            "type": "shell",
            "inline": [
                "sudo apt-get update && sudo apt-get upgrade -y"
            ]
        },
        {
            "type": "ansible",
            "playbook_file": "apt.yml",
            "user": "{{user `gcloud_ssh_username`}}",
            "ansible_env_vars": [
                "ANSIBLE_HOST_KEY_CHECKING=False",
                "ANSIBLE_FORCE_COLOR=True"
            ]
        }
    ]
}


